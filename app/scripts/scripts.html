<md-content layout="column">
  <md-card md-whiteframe="2" flex>
    <md-toolbar class="md-table-toolbar md-default">
      <div class="md-toolbar-tools">
        <span>Scripts</span>
      </div>
    </md-toolbar>

    <md-table-container>
      <table md-table>
        <thead md-head>
          <tr md-row>
            <th md-column>Script</th>
            <th md-column>Description</th>
            <th md-column>Run</th>
          </tr>
        </thead>
        <tbody md-body>
          <tr
            md-row
            ng-repeat="item in viewModel.scripts">
            <td md-cell>{{ item.name }}</td>
            <td md-cell>{{ item.description }}</td>
            <td md-cell>
              <span ng-if="!item.enabled">Disabled</span>
              <md-button
                class="md-icon-button"
                ng-if="!!item.enabled"
                ng-click="viewModel.run($event, item)">
                <md-icon
                  class="md-24"
                  md-font-src="material-icons">
                  play_arrow
                </md-icon>
              </md-button>
            </td>
          </tr>
        </tbody>
      </table>
    </md-table-container>
  </md-card>

  <md-card md-whiteframe="2" flex>
    <md-toolbar class="md-table-toolbar md-default">
      <div class="md-toolbar-tools">
        <span>Run history</span>
      </div>
    </md-toolbar>

    <md-table-container>
      <table
        md-table
        md-progress="viewModel.promise">
        <thead md-head>
          <tr md-row>
            <th md-column>User</th>
            <th md-column>Script</th>
            <th md-column>Duration</th>
            <th md-column>Result</th>
          </tr>
        </thead>
        <tbody md-body>
          <tr
            md-row
            ng-class="{ scriptFailed: !item.success }"
            ng-repeat="item in viewModel.data">
            <td md-cell>
              <a ng-href="/users/{{ item.user.id }}">
                <img ng-src="{{ item.user.image }}" class="userAvatar md-avatar" alt="{{ item.user.name }}">
                  <md-tooltip md-direction="bottom">{{ item.user.name }}</md-tooltip>
                </img>
              </a>
            </td>
            <td md-cell>{{ item.script.name }}</td>
            <td md-cell>
              <span>
                {{ item.duration | date : 'm:ss': 'UTC' }}
                <md-tooltip>
                  {{ item.start | date : 'short' }} - {{ item.end | date : 'shortTime' }}
                </md-tooltip>
              </span>
            </td>
            <td md-cell>
              <md-icon
                class="md-24"
                style="color: red"
                ng-if="!item.success"
                md-font-src="material-icons">
                close
                <md-tooltip md-direction="bottom">Failed</md-tooltip>
              </md-icon>
              <md-icon
                class="md-24"
                style="color: green"
                ng-if="!!item.success"
                md-font-src="material-icons">
                check
                <md-tooltip md-direction="bottom">Success</md-tooltip>
              </md-icon>
            </td>
          </tr>
        </tbody>
      </table>
    </md-table-container>
    <md-table-pagination
      md-page-select
      md-page="viewModel.query.page"
      md-limit="viewModel.query.limit"
      md-limit-options="viewModel.query.limitOptions"
      md-total="{{ viewModel.total }}"
      md-on-paginate="viewModel.getData">
    </md-table-pagination>
  </md-card>
</md-content>
